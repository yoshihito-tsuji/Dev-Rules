# Claude Code グローバル設定

## エージェント起動ルール

### code-reviewer の自動起動条件

- **大きなコード変更（3ファイル以上、または100行以上）を完了した後は、必ずcode-reviewerエージェントを起動すること。**

- **複数ファイルに変更がある場合は、並列でcode-reviewerを起動すること。**

- **以下のパターンに該当するファイルを変更した場合は、必ずcode-reviewerエージェントを起動すること：**
  - セキュリティ関連（auth*, security*, credential*, *_secret*, *.env*）
  - API関連（*api*, *endpoint*, *route*)
  - 認証処理（*login*, *signin*, *auth*)
  - データベース（*db*, *database*, *sql*, *query*)
  - シェルスクリプト（*.sh）
  - Web公開スクリプト（*_script.js, google_apps_script.js）

### レビュー観点の優先順位（全プロジェクト共通）

1. 🔴 **Critical（必須対応）**
   - セキュリティ脆弱性（SQLインジェクション、XSS、コマンドインジェクション）
   - 認証情報の漏洩リスク
   - データ損失のリスク

2. 🟡 **Warning（推奨対応）**
   - エラーハンドリングの不足
   - パフォーマンス問題
   - ベストプラクティス違反

3. 🟢 **Suggestion（改善提案）**
   - 可読性の向上
   - コードの重複削減
   - ドキュメント追加

## コミットメッセージルール

- コミットメッセージは日本語で記述すること
- 変更の意図（why）を明確に記述すること
- 以下のプレフィックスを使用すること：
  - `Add:` 新機能追加
  - `Update:` 既存機能の改善
  - `Fix:` バグ修正
  - `Refactor:` リファクタリング
  - `Docs:` ドキュメント更新
  - `Security:` セキュリティ対応

## プルリクエストルール

- PRタイトルは変更の要約を明確に記述
- 以下のセクションを含めること：
  - **Summary**: 変更内容の要約（3-5行）
  - **Test plan**: テスト手順のチェックリスト
  - **Security considerations**: セキュリティ観点でのチェック項目（該当する場合）

## コード品質基準

### セキュリティ

- 認証情報はハードコードしない（環境変数、設定ファイルを使用）
- ユーザー入力は必ずバリデーション・サニタイズすること
- API通信はHTTPSを使用すること

### エラーハンドリング

- 外部API呼び出しには必ずエラーハンドリングを実装
- エラーメッセージは具体的かつユーザーフレンドリーに
- ログ出力を適切に行うこと

### 可読性

- 関数は単一責任の原則に従う
- 変数名・関数名は意図が明確にわかるものにする
- 複雑なロジックには適切なコメントを追加

## 三者間協働ルール（Yoshihitoさん・Codex・Claude Code）

### 開発方法論: Dev-Rules

全プロジェクト共通の三者協働開発方法論。各プロジェクトのREADME.mdに参照あり。
- **GitHub**: https://github.com/yoshihito-tsuji/Dev-Rules
- **ローカル**: 各プロジェクトの `../Dev-Rules/` に配置
- **Claude Code Best Practice**: `../Dev-Rules/claude-code/README.md`

### Claude Code Best Practice（要点）

- CLAUDE.mdは150行以下を目標に簡潔に保つ
- 複雑なタスクはプランモードから開始する
- サブタスクはコンテキスト使用率50%以内で完了できる単位に分割
- コンテキスト使用率50%で手動 /compact を実施
- タスク完了後すぐにコミットする
- コマンド→エージェント→スキルの3層アーキテクチャを活用

### コミュニケーション

- **From/To記法を使用すること**
  - 例: `From: Claude Code, To: Codex`
  - 例: `From: Claude Code, To: Yoshihitoさん`

### 意思決定優先順位

1. **Yoshihitoさんの意図・要望が最優先**
2. Codexのアーキテクチャ・設計方針
3. 技術的なベストプラクティス

### 役割分担

- **Yoshihitoさん**: プロジェクトオーナー、最終意思決定者
- **Codex**: アーキテクト、設計者、技術方針策定
- **Claude Code**: 実装エンジニア、コードレビュー実施

### レビュー後の報告

- コードレビュー完了後は、必ず結果をYoshihitoさんに報告すること
- 重要な変更や判断が必要な場合は、実装前にYoshihitoさんに確認を求めること

## UX心理学・デザイン原則（全プロジェクト共通）

### 1. 判断・意思決定に影響する原則

#### 価格・選択肢の提示

- **アンカー効果**: 最初に示す数字が基準になり、後の判断を歪める
- **おとり効果**: 比較対象のおとりを挟むと、狙った選択肢が選ばれやすくなる
- **デフォルト効果**: 初期設定のまま選びがちになる
- **損失回避**: 利益よりも損失を強く嫌う
- **希少性効果**: 「残りわずか」などで価値が上がる
- **授かり効果**: 所有しているものを高く評価しがち
- **サンクコスト効果**: 投下済みの労力を理由に、やめられなくなる

#### 表現・言い回しの影響

- **フレーミング効果**: 同じ内容でも表現で判断が変わる
- **確証バイアス**: 自分の仮説と同じ情報だけ選びがち
- **期待バイアス**: 事前の期待が体験の評価を決める
- **ナッジ**: 強制せずに望ましい方向へ背中を押す
- **誘導抵抗**: 強く押されると逆らいたくなる

#### 行動の開始・継続・中断

- **決断疲れ**: 選択が多いと判断の質が落ちる
- **段階的要請**: 小さな依頼→大きな依頼が通りやすい
- **目標勾配効果**: ゴールに近づくほどやる気が上がる
- **ツァイガルニク効果**: 未完了のタスクが気になり続ける
- **変動強化**: 報酬がランダムだと行動が強化される
- **ピークエンドの法則**: 体験はピークと最後で評価される
- **努力の錯覚**: 処理中アニメなどで「頑張っている感」で満足度が上がる
- **0.4秒の壁（もっさり閾値）**: 応答が0.4秒を超えると離脱が増える

### 2. 認知・注意・理解に関する原則

#### 注意と負荷

- **認知負荷**: 処理量が多いと理解・行動が落ちる
- **バナーブラインドネス**: 広告っぽい要素は無視される
- **選択的注意**: 必要な情報だけ見て他は無視される
- **系列位置効果**: リストの最初と最後が記憶されやすい
- **プライミング効果**: 事前刺激が無意識に判断に影響する

#### 視覚デザインの主要原則

- **美的ユーザビリティ効果**: 美しいは使いやすいの印象を与える
- **視覚的階層**: 優先順位を視覚で示す
- **ビジュアル・アンカー**: 最初に目が行く「芯」を配置する
- **スキューモーフィズム**: 現実の見た目を模倣すると理解が速い

### 3. 社会的・対人的影響

- **社会的証明**: 他者の行動を評価の基準にする
- **ハロー効果**: 一部の良さが全体評価を押し上げる
- **観察効果**: 見られていると行動が変わる
- **ピグマリオン効果**: 期待が高いとパフォーマンスが上がる
- **親近性バイアス**: 馴染みがあるデザインほど安心する
- **期待のギャップ**: 仕様と利用者のズレが生まれやすい
- **ユーザー歓迎（Delight）**: 小さな驚きや気配りが満足度を上げる

### 4. 導線・オンボーディング・リサーチ

- **段階的開示**: 必要なときだけ情報・機能を表示する
- **即応型オンボーディング**: ユーザー行動に応じて案内を出す
- **意図的な壁（Friction）**: 誤操作防止のため、あえて一手間置く
- **ゲーミフィケーション**: ポイント・バッジなどで継続を促す
- **調査バイアス**: 質問の仕方・対象の選び方でデータが歪む

### 5. UI/UX設計時の実践的指針

#### 情報配置の原則

- **重要情報は 最初・最後・強調箇所 に配置する**
- **認知負荷は常に最小化**し、必要な場面のみ詳細を開示する
- **進捗・状況は必ず可視化する**（例：進捗バー・ローディング）

#### ユーザー誘導の原則

- **強制せず、ナッジで優しく誘導する**。過度な白さは避ける
- **レビュー数・利用者数などの社会的証明は適度に提示する**
- **離脱させない目配りには、0.4秒以内のフィードバックを返す**

#### 体験設計の原則

- **フロー全体は、ピーク（良い体験）とエンド（快い完了）が重要**
- **ユーザーが「やるべきこと」を認識できるようにする**（ツァイガルニク効果）
- **未完了タスクの可視化でモチベーション維持**

### 6. 実装時の注意事項（Claude Code向け）

- UI実装時は上記原則を意識し、**認知負荷を最小化**すること
- **デフォルト値は慎重に設定**（デフォルト効果を考慮）
- **エラーメッセージは損失回避を意識**し、ポジティブな代替案を提示
- **ローディング表示は0.4秒以内を目標**、それ以上かかる場合は進捗表示を実装
- **重要なアクション（削除など）には意図的な壁（確認ダイアログ）を設ける**
- **ボタン・リンクの配置は系列位置効果を考慮**（重要なものは最初か最後）
- **視覚的階層を明確にする**（サイズ・色・配置で優先順位を示す）
